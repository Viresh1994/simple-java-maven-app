name: Helm

on:
  workflow_dispatch:
    inputs:
      component:
        description: 'Select DAMS component to deploy'
        type: choice
        required: true
        options:
          - damsui
          - damscorapi
          - damsbatchjobs

      version:
        description: 'Select version to deploy'
        type: choice
        required: true
        options:
          - 0.0.1
          - 0.0.2
          - 0.0.3
          - 0.0.4
          - latest
        default: latest

      environment:
        description: 'Target deployment environment'
        type: choice
        required: true
        options:
          - DEV
          - ITT
          - UAT

permissions:
  id-token: write
  contents: read

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}

    steps:

      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Display deployment info
        run: |
          echo "Component : ${{ inputs.component }}"
          echo "Version   : ${{inputs.version }}"
          echo "Environment : ${{inputs.environment }}"
        
      - name: Deploy using Helm
        run: |
          helm upgrade --install ${{inputs.component }} ./helm/${{ inputs.component }} \ --namespace dams-${{ inputs.environment }} \
          -f ./helm/${{ inputs.component }}/values-${{ inputs.environment }}.yaml

